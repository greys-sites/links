import{p as h}from"./parse.d12b0d5b.js";import{j as y}from"./singletons.b7483f1b.js";const A=y("invalidate_all"),w=y("apply_action");function E(e){const r=JSON.parse(e);return r.data&&(r.data=h(r.data)),r}function F(e,r=()=>{}){const c=async({action:a,result:n,reset:i})=>{n.type==="success"&&(i!==!1&&HTMLFormElement.prototype.reset.call(e),await A()),(location.origin+location.pathname===a.origin+a.pathname||n.type==="redirect"||n.type==="error")&&w(n)};async function l(a){var u,d,b;a.preventDefault();const n=new URL((u=a.submitter)!=null&&u.hasAttribute("formaction")?a.submitter.formAction:HTMLFormElement.prototype.cloneNode.call(e).action),i=new FormData(e),s=(d=a.submitter)==null?void 0:d.getAttribute("name");s&&i.append(s,((b=a.submitter)==null?void 0:b.getAttribute("value"))??"");const p=new AbortController;let m=!1;const f=await r({action:n,cancel:()=>m=!0,controller:p,data:i,form:e,submitter:a.submitter})??c;if(m)return;let o;try{const t=await fetch(n,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:i,signal:p.signal});o=E(await t.text()),o.type==="error"&&(o.status=t.status)}catch(t){if((t==null?void 0:t.name)==="AbortError")return;o={type:"error",error:t}}f({action:n,data:i,form:e,update:t=>c({action:n,result:o,reset:t==null?void 0:t.reset}),result:o})}return HTMLFormElement.prototype.addEventListener.call(e,"submit",l),{destroy(){HTMLFormElement.prototype.removeEventListener.call(e,"submit",l)}}}export{F as e};
